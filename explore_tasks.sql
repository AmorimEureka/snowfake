
SHOW TASKS
;


CREATE OR REPLACE TABLE 
EXEMPLO (
    MY_ID INT
)
;


CREATE OR REPLACE TASK 
PRIMEIRA_TASK
    WAREHOUSE = DW_AULA
    SCHEDULE = 'USING CRON * * * * * America/Fortaleza'
    AS
      INSERT INTO EXEMPLO SELECT RANDOM()
;


ALTER TASK PRIMEIRA_TASK RESUME
;


SELECT
    *
FROM EXEMPLO
;


ALTER TASK PRIMEIRA_TASK SUSPEND
;


DROP TASK PRIMEIRA_TASK
;



-- *******************************************************



SHOW TASKS
;


CREATE OR REPLACE TABLE 
EXEMPLO (
    MY_ID INT
)
;


CREATE OR REPLACE TABLE 
EXEMPLO_2 (
    MY_ID INT
)
;


CREATE OR REPLACE TASK 
PRIMEIRA_TASK
    WAREHOUSE = DW_AULA
    SCHEDULE = 'USING CRON * * * * * America/Fortaleza'
    AS
      INSERT INTO EXEMPLO SELECT RANDOM()
;


CREATE OR REPLACE TASK 
SEGUNDA_TASK
    WAREHOUSE = DW_AULA
    AFTER PRIMEIRA_TASK
    AS
      INSERT INTO EXEMPLO_2 SELECT RANDOM()
;


DELETE FROM EXEMPLO
;


// PARA TRIGGAR TASK's COM HIRARQUIA
// A TASK FILHA TERÁ PRECEDENCIA
ALTER TASK SEGUNDA_TASK RESUME
;
ALTER TASK PRIMEIRA_TASK RESUME
;


SELECT
    *
FROM EXEMPLO, EXEMPLO_2
;


// PARA TRIGGAR TASK's COM HIRARQUIA
// A TASK PAI TERÁ PRECEDENCIA
ALTER TASK PRIMEIRA_TASK SUSPEND
;
ALTER TASK SEGUNDA_TASK SUSPEND
;


DROP TASK PRIMEIRA_TASK
;

// LOG's DE EXECUÇÃO DAS TASKS
SELECT
    *
FROM TABLE(INFORMATION_SCHEMA.task_history())
;